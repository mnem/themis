var FAPI_ENDPOINT=null;var RE_FAPI_ROOT=null;var _active_dir={location:null};var _active_file={location:null,dir:null};var last_active_element=null;function setActiveFileLocation(a,b){_active_file.location=a;_active_file.dir=b;$("#active-file-location").text(a.replace(RE_FAPI_ROOT,""))}function getActiveFileLocation(){return _active_file.location}function getActiveFileDirLocation(){return _active_file.dir}function setActiveDir(a){_active_dir.location=a}function getActiveDir(){return _active_dir.location}function makeFileID(a){return"___FID_"+a.replace(/(:|\.)/g,"__")}function _el_file(a,d,c,e){var b=$('<li><a id="'+makeFileID(a)+'" href="'+d+'"><i class="'+c+'"></i>'+a+"</a></li>");if(e){b.click(function(f){e(d,b);f.preventDefault()})}return b}function revertFile(){if(getActiveFileLocation()){showFile(getActiveFileLocation())}}function validPluginName(a){return/^[a-z0-9-_]+$/i.test(a)}function validateNewPluginName(){if(validPluginName($("#new-plugin-name").val())){$("#create-new-plugin").removeClass("disabled");$("#alert-invalid-plugin-name").css("display","none")}else{$("#create-new-plugin").addClass("disabled");$("#alert-invalid-plugin-name").css("display","block")}}function newPlugin(){var c=$("#new-plugin-name").val();if(validPluginName(c)){c=c+".plugin.coffee";var b=getActiveDir();if(b[b.length-1]!="/"){b=b+"/"}var a=b+c;var e=makeFileID(c);var d=$(e);if(d.length!=0){d.click()}else{_UIHintValidFileBeingShown();setActiveFileLocation(a,b);if(last_active_element){last_active_element.removeClass("active")}last_active_element=_el_file(c,a,"icon-file",showFile);last_active_element.addClass("active");$("#files").append(last_active_element);editor.getSession().setValue(PLUGIN_TEMPLATE)}$("#new-file-dialog").modal("hide")}}function saveFile(){if(getActiveFileLocation()){$.post(getActiveFileLocation(),{data:editor.getSession().getValue()},function(b,c,a){if(console&&console.info){console.info("Saved file",b,c,a)}},"text")}}function _UIHintValidFileBeingShown(){$("#action-save").removeClass("disabled");$("#action-revert").removeClass("disabled");$("#active-file-location").css("display","inline");$("#label-active-file-location").css("display","inline")}function showFile(a,c){if(c==last_active_element){return}_UIHintValidFileBeingShown();if(last_active_element){last_active_element.removeClass("active")}last_active_element=c;c.addClass("active");var b=new String(getActiveDir());$.get(a,function(e,f,d){setActiveFileLocation(a,b);editor.getSession().setValue(e)})}function _appendFileItems(a,d,g){a.sort(function(i,h){return i.file.localeCompare(h.file)});var f=$("#files");for(var b=0;b<a.length;b++){var e=a[b];var c=_el_file(e.file,e.link,d,g);f.append(c);if(e.active){c.addClass("active")}}}function showDirectory(a){$.getJSON(a,function(g,d,j){setActiveDir(g.current);if(FAPI_ENDPOINT==null){FAPI_ENDPOINT=g.current;if(FAPI_ENDPOINT[FAPI_ENDPOINT.length-1]=="/"){FAPI_ENDPOINT=FAPI_ENDPOINT.substr(0,FAPI_ENDPOINT.length-1)}RE_FAPI_ROOT=new RegExp("^"+FAPI_ENDPOINT.replace("/","/"))}last_active_element=null;var h=$("#files");h.empty();if(RE_FAPI_ROOT.test(g.up)){h.append(_el_file("..",g.up,"icon-circle-arrow-left",showDirectory))}var b=[];for(var f in g.ls){var e=g.ls[f];if(e.directory){b.push({file:f,link:e.link})}}var c=[];var i=null;for(var f in g.ls){var e=g.ls[f];if(!e.directory){c.push({file:f,link:e.link,active:e.link==getActiveFileLocation()})}}_appendFileItems(b,"icon-folder-close",showDirectory);_appendFileItems(c,"icon-file",showFile)})}$(function(){editor=ace.edit("editor");editor.setTheme("ace/theme/solarized_dark");editor.setShowInvisibles(false);editor.getSession().setMode("ace/mode/coffee");editor.getSession().setTabSize(4);editor.getSession().setUseSoftTabs(true);editor.getSession().setValue("# Select a plugin from the left to start editing");$("#action-revert").click(function(a){revertFile()});$("#action-save").click(function(a){saveFile()});$("#create-new-plugin").click(function(a){newPlugin()});$("#new-file-dialog").on("shown",function(){$("#new-plugin-name").focus();validateNewPluginName()});$("#active-file-location").click(function(a){if(getActiveFileLocation()){showDirectory(getActiveFileDirLocation())}a.preventDefault()});$("#new-plugin-name").change(function(){validateNewPluginName()});$("#new-plugin-name").keyup(function(){validateNewPluginName()});showDirectory("/fapi")});